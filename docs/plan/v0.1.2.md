# npm → pnpm 移行 + Node.js LTS 化

## Context

このリポジトリは npm でパッケージ管理しており、プロジェクトレベルの `.tool-versions` が存在しない。
Node.js と pnpm を `.tool-versions` で明示的にバージョン管理し、パッケージマネージャを pnpm に移行する。
Node.js は現在の 23.10.0（Current）から最新 LTS の 24.13.1 に変更する。

## スコープ

- **やること**: `.tool-versions` 新規作成（Node.js 24.13.1 + pnpm 10.29.3）、npm → pnpm 移行
- **やらないこと**: 依存パッケージのバージョン更新
- **判断**:
  - wrangler: npm パッケージなので devDependencies のまま
  - Biome: Neovim が `node_modules/.bin/biome` を参照しているので devDependencies のまま

## タスク

### タスク 1: `.tool-versions` 作成（Node.js + pnpm）

**変更対象**: `.tool-versions`（新規作成）

**手順**:
1. `mise use node@24.13.1` で Node.js LTS を設定
2. `mise use pnpm@10.29.3` で pnpm を追加
3. `mise install` で両ツールをインストール

**受入条件**:
- WHEN `node --version` THEN `v24.13.1`
- WHEN `pnpm --version` THEN バージョンが表示される
- WHEN `.tool-versions` を確認 THEN `nodejs` と `pnpm` が記載されている

---

### タスク 2: npm → pnpm ロックファイル移行

**変更対象**: `package-lock.json`（削除）、`pnpm-lock.yaml`（新規生成）

**手順**:
1. `package-lock.json` を削除
2. `node_modules/` を削除
3. `pnpm install` で `pnpm-lock.yaml` を生成

**受入条件**:
- WHEN `pnpm install` THEN 正常完了し `pnpm-lock.yaml` が生成される
- WHEN `ls package-lock.json` THEN ファイルが存在しない

---

### タスク 3: `package.json` に `packageManager` フィールド追加

**変更対象**: `package.json`

**手順**:
1. `packageManager` フィールドを追加（`"packageManager": "pnpm@10.29.3"`）

**受入条件**:
- WHEN `package.json` を確認 THEN `packageManager` フィールドが存在する

---

### タスク 4: CLAUDE.md の npm 参照を pnpm に更新

**変更対象**: `CLAUDE.md`

**変更内容**:
- `npm run dev` → `pnpm dev`
- `npm run db:migrate:local` → `pnpm db:migrate:local`

**受入条件**:
- WHEN `CLAUDE.md` を grep THEN `npm run` への参照がない

---

### タスク 5: `.claude/settings.local.json` の権限更新

**変更対象**: `.claude/settings.local.json`

**変更内容**:
- `Bash(npm create:*)` → `Bash(pnpm create:*)`
- `Bash(npm install:*)` → `Bash(pnpm install:*)`
- `Bash(npm --version:*)` → `Bash(pnpm --version:*)`

**受入条件**:
- WHEN `settings.local.json` を確認 THEN npm 固有の権限が pnpm に置き換わっている

---

### タスク 6: 動作検証

**手順**:
1. `pnpm test` — テストが全件パスする
2. `pnpm typecheck` — 型チェックが通る
3. `pnpm lint` — lint が通る

**受入条件**:
- WHEN 上記3コマンド THEN すべて正常終了

## 変更ファイル一覧

| ファイル | 操作 |
|---------|------|
| `.tool-versions` | 新規作成（nodejs 24.13.1 + pnpm 10.29.3） |
| `package-lock.json` | 削除 |
| `pnpm-lock.yaml` | 新規生成（pnpm install） |
| `package.json` | `packageManager` フィールド追加 |
| `CLAUDE.md` | `npm run` → `pnpm` 参照更新 |
| `.claude/settings.local.json` | 権限の npm → pnpm 更新 |
