# v0.9.0: tool_parameters から MCP サーバー名・ツール名・skill 名を表示

## Context

GitHub Issue #29。`OTEL_LOG_TOOL_DETAILS=1` 有効時、`tool_results.tool_parameters` JSON に MCP サーバー名 (`mcp_server_name`)、MCP ツール名 (`mcp_tool_name`)、skill 名 (`skill_name`) が含まれる。現状 Tool Usage セクションは `tool_name` のみで集計・表示しており、MCP ツールの区別や skill の特定ができない。

## 方針

- **カラム分解**: `mcp_server_name`, `mcp_tool_name`, `skill_name` を専用カラムとして追加（マイグレーション 0003）
- **パーサー変更**: `tool_parameters` JSON から INSERT 時に 3 フィールドを抽出し専用カラムに格納
- **既存データのバックフィル**: マイグレーション内で `json_extract` を使い既存行の新カラムを埋め戻す
- **不要カラム削除**: `tool_results.decision`, `tool_results.source` を DROP（`tool_decisions` テーブルと重複、未使用）
- **tool_parameters カラム維持**: SessionTimeline の Bash command 表示 + 将来の OTLP スキーマ拡張に備えて残す
- **UI**: フラットリスト維持 + カテゴリバッジ（MCP / Skill）追加
- **フォールバック**: 新カラムが NULL の場合、`tool_name` パターン (`mcp__<server>__<tool>`) から推定

## タスク

### タスク 0: 計画ファイル保存 + 作業ブランチ作成

### タスク 1: マイグレーション（カラム追加 + バックフィル + 不要カラム削除）

- `migrations/0003_tool_detail_columns.sql`
- ADD COLUMN × 3 + UPDATE バックフィル + DROP COLUMN × 2

### タスク 2: ドメイン型 + パーサー + リポジトリの更新

- `ParsedToolResult` から decision/source 削除、mcpServerName/mcpToolName/skillName 追加
- `parseToolResult()` で tool_parameters JSON から 3フィールド抽出
- `insertToolResults()` の INSERT 文更新

### タスク 3: getToolUsage クエリ + ToolUsageRow 型の拡張

- SQL に 3 新カラム追加、GROUP BY を tool_name + skill_name に変更
- ToolUsageRow 型拡張

### タスク 4: 表示名ヘルパー関数の作成

- `src/lib/tool-display.ts` 新規作成
- getToolDisplayInfo() で MCP/Skill/builtin を判定

### タスク 5: ToolUsage コンポーネント + チャートの更新

- テーブルにカテゴリバッジ表示
- チャートラベルに displayName 使用

### タスク 6: シードデータの更新

- MCP/Skill ツール定義追加
- INSERT 文から decision/source 削除、3 新カラム追加
